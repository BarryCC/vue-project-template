<style scoped>
#mapbox{
  width: 50%;
  height: 700px;
}
</style>

<template>
<div class="mapbox">
  <div id="mapbox"></div>
</div>
</template>

<script>
    import mapboxgl from 'mapbox-gl';
    export default {
        name: 'mapbox',
        data(){
            return{
              mapRoot:'',
              linesGeojson:[]
            }
        },
        methods:{
          mapInit(){
            mapboxgl.accessToken = 'pk.eyJ1IjoiY2NtYXAiLCJhIjoiY2phdGQwYTh4MXY3dTMzcGYxdnVteHkzaCJ9.t3IJiqlK-GjM3B0kNnokmQ';
            this.mapRoot = new mapboxgl.Map({
              container: 'mapbox',
              style: 'mapbox://styles/ccmap/cjb1n0es5c1h02rr0jqh45ayi',
              center: [121.498,31.229],
              zoom: 14,
              pitch: 50,
            });
            this.mapRoot.addControl(new mapboxgl.ScaleControl());
            this.mapRoot.addControl(new mapboxgl.FullscreenControl());
            this.mapEvent();
          },
          mapEvent(){
            let that = this;
            that.mapRoot.on('load', function() {
                that.test();
              //that.backgroundColor();
              //that.subwayLine();
              //that.buildingLayer();
              //that.heatMap();
            });
            //当缩放到一定程度地铁线路消失 14.85
            /*that.mapRoot.on('zoom',function () {
              //console.log(that.mapRoot.getZoom());
              let currtentZoom = that.mapRoot.getZoom();
              if( currtentZoom < 14 ){
                that.mapRoot.setLayoutProperty('line', 'visibility', 'none');
              }else {
                that.mapRoot.setLayoutProperty('line', 'visibility', 'visible');
              }
            });*/
          },
          backgroundColor(){
            this.mapRoot.addLayer({
              'id': 'background',
              'type': 'background',
              'layout': {
              },
              'paint': {
                  "background-color":"rgba(0, 0, 0, 0.2)"
              }
            });
          },
          subwayLine(){
            const lines = [
              {
                name:'Line1',
                data:[
                  [121.431023,31.39867],
                  [121.434292,31.387738],
                  [121.4374,31.376239],
                  [121.440472,31.361609],
                  [121.441002,31.353522],
                  [121.444173,31.346005],
                  [121.447856,31.337786],
                  [121.453444,31.32534],
                  [121.455115,31.313],
                  [121.456588,31.298823],
                  [121.458492,31.285878],
                  [121.461906,31.27807],
                  [121.465589,31.265292],
                  [121.462355,31.253639],
                  [121.464978,31.247959],
                  [121.474806,31.244686],
                  [121.481669,31.238913],
                  [121.483883,31.235586],
                  [121.484682,31.232506],
                  [121.484682,31.232506],
                  [121.484462,31.231433],
                  [121.483214,31.230059],
                  [121.4798,31.228754],
                  [121.466667,31.223551],
                  [121.45772,31.219984],
                  [121.453156,31.211368],
                  [121.444766,31.199183],
                  [121.442808,31.188387],
                  [121.439978,31.165122],
                  [121.439978,31.165122],
                  [121.440032,31.165215],
                  [121.436241,31.161383],
                  [121.409292,31.136845],
                  [121.399878,31.127077],
                  [121.391613,31.11669]
                ]
              }, {
                name:'Line2',
                data:[
                  [121.307524,31.195432],
                  [121.327838,31.200351],
                  [121.327838,31.200351],
                  [121.331674,31.200914],
                  [121.332671,31.201015],
                  [121.338618,31.200876],
                  [121.33957,31.201192],
                  [121.339965,31.201563],
                  [121.341115,31.20391],
                  [121.340989,31.204706],
                  [121.340989,31.204706],
                  [121.339696,31.223205],
                  [121.342355,31.224101],
                  [121.365199,31.224101],
                  [121.380686,31.222171],
                  [121.393998,31.220441],
                  [121.393998,31.220441],
                  [121.412719,31.216913],
                  [121.412719,31.216913],
                  [121.422744,31.224263],
                  [121.438932,31.226208],
                  [121.441963,31.226417],
                  [121.442929,31.225857],
                  [121.443401,31.225815],
                  [121.452694,31.229589],
                  [121.46677,31.236143],
                  [121.479239,31.238829],
                  [121.49027,31.242951],
                  [121.49027,31.242951],
                  [121.521962,31.239107],
                  [121.533437,31.234854],
                  [121.549935,31.225869],
                  [121.554804,31.222815],
                  [121.557194,31.215878],
                  [121.558294,31.213199],
                  [121.561663,31.209864],
                  [121.562121,31.209559],
                  [121.562215,31.209505],
                  [121.563181,31.209466],
                  [121.577688,31.209188],
                  [121.586267,31.206887],
                  [121.594047,31.207914],
                  [121.608527,31.209968],
                  [121.627131,31.216747],
                  [121.662614,31.219928],
                  [121.669361,31.221696],
                  [121.672388,31.222074],
                  [121.674894,31.222005],
                  [121.678236,31.220862],
                  [121.679943,31.220013],
                  [121.687291,31.20315],
                  [121.692429,31.191891],
                  [121.694208,31.19135],
                  [121.696777,31.191041],
                  [121.697747,31.191064],
                  [121.704502,31.19291],
                  [121.73032,31.198625],
                  [121.76212,31.205219],
                  [121.777355,31.206455],
                  [121.780679,31.205544],
                  [121.782098,31.204617],
                  [121.783068,31.203443],
                  [121.783751,31.202602],
                  [121.80319,31.174992],
                  [121.80319,31.174992]
                ]
              }, {
                name:'Line3',
                data:[
                  [121.446236,31.414253],
                  [121.467831,31.414338],
                  [121.482528,31.409962],
                  [121.486103,31.401302],
                  [121.494673,31.387107],
                  [121.49938,31.376595],
                  [121.505327,31.363645],
                  [121.507123,31.350848],
                  [121.498068,31.337548],
                  [121.491466,31.325565],
                  [121.491663,31.311343],
                  [121.489615,31.295114],
                  [121.488995,31.28706],
                  [121.485672,31.276783],
                  [121.486552,31.26578],
                  [121.48701,31.262191],
                  [121.487073,31.261778],
                  [121.486844,31.260424],
                  [121.486574,31.259691],
                  [121.485613,31.258796],
                  [121.483282,31.257638],
                  [121.465177,31.255782],
                  [121.447516,31.260968],
                  [121.436287,31.252772],
                  [121.424358,31.245517],
                  [121.41983,31.238648],
                  [121.422399,31.224011],
                  [121.423603,31.215812],
                  [121.427358,31.203474],
                  [121.433215,31.193234],
                  [121.444713,31.183009],
                  [121.450822,31.175779],
                  [121.449259,31.164177],
                  [121.437527,31.159913]
                ]
              }, {
                name:'Line4',
                data:[
                  [121.424383,31.245632],
                  [121.436259,31.25281],
                  [121.436259,31.25281],
                  [121.445844,31.260666],
                  [121.447488,31.260944],
                  [121.464268,31.256206],
                  [121.473161,31.252787],
                  [121.474572,31.25288],
                  [121.475218,31.253034],
                  [121.47741,31.25406],
                  [121.482881,31.257402],
                  [121.494846,31.2638],
                  [121.496104,31.264139],
                  [121.507548,31.266601],
                  [121.513585,31.267658],
                  [121.514654,31.267546],
                  [121.515323,31.267338],
                  [121.515615,31.267195],
                  [121.516527,31.266489],
                  [121.51959,31.263715],
                  [121.52392,31.25768],
                  [121.526022,31.24581],
                  [121.533433,31.234888],
                  [121.536873,31.233051],
                  [121.537143,31.232622],
                  [121.538517,31.229017],
                  [121.539002,31.227582],
                  [121.539375,31.225015],
                  [121.539191,31.22376],
                  [121.535144,31.218777],
                  [121.534497,31.217642],
                  [121.532557,31.214202],
                  [121.532297,31.213936],
                  [121.532225,31.213901],
                  [121.532081,31.213874],
                  [121.525757,31.215268],
                  [121.514429,31.21936],
                  [121.513199,31.219437],
                  [121.512237,31.219012],
                  [121.50638,31.214302],
                  [121.496158,31.207732],
                  [121.480976,31.205029],
                  [121.470161,31.200427],
                  [121.461339,31.19706],
                  [121.452159,31.193624],
                  [121.450241,31.192187],
                  [121.447523,31.190276],
                  [121.443975,31.189256],
                  [121.43978,31.189615],
                  [121.437444,31.19043],
                  [121.435015,31.191801],
                  [121.433874,31.193075],
                  [121.427334,31.203527],
                  [121.423543,31.215773],
                  [121.42233,31.223972],
                  [121.419761,31.2384],
                  [121.421432,31.242842],
                  [121.422092,31.24383],
                  [121.422645,31.244401],
                  [121.424383,31.245632]
                ]
              }, {
                name:'Line5',
                data:[
                  [121.391636,31.116674],
                  [121.389445,31.113861],
                  [121.389211,31.113057],
                  [121.388959,31.110847],
                  [121.389211,31.109471],
                  [121.392337,31.103967],
                  [121.396901,31.095093],
                  [121.408435,31.072842],
                  [121.41652,31.051164],
                  [121.422973,31.032572],
                  [121.426326,31.024468],
                  [121.42703,31.02245],
                  [121.427021,31.021707],
                  [121.426787,31.021019],
                  [121.426423,31.020446],
                  [121.425943,31.019974],
                  [121.425386,31.019657],
                  [121.416564,31.017212],
                  [121.401536,31.013142],
                  [121.387199,31.009304],
                  [121.376563,31.006302]
                ]
              }, {
                name:'Line6',
                data:[
                  [121.581263,31.359353],
                  [121.581263,31.359353],
                  [121.600559,31.341374],
                  [121.608679,31.327278],
                  [121.605825,31.32199],
                  [121.595924,31.318425],
                  [121.595852,31.308645],
                  [121.595327,31.296804],
                  [121.594989,31.28686],
                  [121.594522,31.278065],
                  [121.5933,31.270102],
                  [121.588374,31.263292],
                  [121.579359,31.256706],
                  [121.570627,31.251705],
                  [121.559309,31.245592],
                  [121.549931,31.242196],
                  [121.540912,31.239108],
                  [121.533402,31.234909],
                  [121.535486,31.226047],
                  [121.534264,31.217678],
                  [121.529835,31.209448],
                  [121.523107,31.198969],
                  [121.516352,31.191324],
                  [121.517484,31.178256],
                  [121.522227,31.165295],
                  [121.522227,31.165295],
                  [121.525542,31.158342],
                  [121.525474,31.157631],
                  [121.525353,31.157338],
                  [121.525092,31.157087],
                  [121.524625,31.156751],
                  [121.521144,31.155607],
                  [121.51297,31.154788],
                  [121.501678,31.154379],
                  [121.486973,31.159385]
                ]
              }, {
                name:'Line7',
                data:[
                  [121.356337,31.407969],
                  [121.364134,31.394469],
                  [121.362338,31.370238],
                  [121.368878,31.363485],
                  [121.379334,31.350627],
                  [121.38016,31.328143],
                  [121.395252,31.326292],
                  [121.405277,31.327279],
                  [121.414763,31.32148],
                  [121.420153,31.310034],
                  [121.422884,31.29976],
                  [121.428058,31.291274],
                  [121.429459,31.28035],
                  [121.429134,31.270802],
                  [121.428238,31.262633],
                  [121.43793,31.253403],
                  [121.444739,31.246272],
                  [121.448719,31.240522],
                  [121.455142,31.229275],
                  [121.455519,31.220018],
                  [121.456696,31.205063],
                  [121.460918,31.197627],
                  [121.46337,31.191356],
                  [121.479971,31.177902],
                  [121.492637,31.180358],
                  [121.501117,31.184112],
                  [121.50719,31.187865],
                  [121.516406,31.191325],
                  [121.531641,31.193488],
                  [121.531641,31.193488],
                  [121.556471,31.199604],
                  [121.563998,31.209966],
                  [121.569226,31.21761]
                ]
              }, {
                name:'Line8',
                data:[
                  [121.51873,31.068452],
                  [121.51873,31.068452],
                  [121.497505,31.142588],
                  [121.486386,31.157575],
                  [121.486961,31.159799],
                  [121.491848,31.163013],
                  [121.499897,31.166721],
                  [121.503059,31.172654],
                  [121.502771,31.193414],
                  [121.502052,31.196553],
                  [121.491273,31.221212],
                  [121.476043,31.2592],
                  [121.473666,31.268603],
                  [121.487464,31.276257],
                  [121.49307,31.282121],
                  [121.496241,31.282295],
                  [121.505251,31.28189],
                  [121.50888,31.279822],
                  [121.51391,31.278587],
                  [121.527529,31.281488],
                  [121.535687,31.28547],
                  [121.539925,31.287722],
                  [121.541572,31.291483],
                  [121.541399,31.298306],
                  [121.541506,31.29843],
                  [121.538524,31.304601],
                  [121.53839,31.320148],
                  [121.538524,31.32854]
                ]
              }, {
                name:'Line9',
                data:[
                  [121.237026,30.997731],
                  [121.238976,31.064322],
                  [121.236257,31.110609],
                  [121.23717,31.117976],
                  [121.261927,31.123594],
                  [121.295129,31.126686],
                  [121.316109,31.140456],
                  [121.404164,31.17622],
                  [121.428653,31.183053],
                  [121.442882,31.202206],
                  [121.458953,31.206499],
                  [121.495343,31.217772],
                  [121.505548,31.226295],
                  [121.517255,31.234325]
                ]
              }, {
                name:'Line10',
                data:[
                  [121.327907,31.200316],
                  [121.343773,31.19924],
                  [121.353834,31.197634],
                  [121.362314,31.196892],
                  [121.377262,31.195904],
                  [121.379993,31.196892],
                  [121.390916,31.202452],
                  [121.398444,31.205074],
                  [121.402846,31.206529],
                  [121.410671,31.204634],
                  [121.423687,31.202329],
                  [121.433748,31.205417],
                  [121.447114,31.211965],
                  [121.451554,31.214535],
                  [121.465512,31.221724],
                  [121.495407,31.227406],
                  [121.494689,31.230988],
                  [121.488519,31.249654],
                  [121.487933,31.25507],
                  [121.493108,31.259391],
                  [121.500582,31.274207],
                  [121.516744,31.295351],
                  [121.521191,31.303805]
                ]
              }, {
                name:'Line11',
                data:[
                  [121.110871,31.304532],
                  [121.147378,31.297621],
                  [121.169152,31.294023],
                  [121.186185,31.292437],
                  [121.195096,31.291696],
                  [121.207457,31.300336],
                  [121.214643,31.315886],
                  [121.221255,31.330693],
                  [121.227579,31.337848],
                  [121.228441,31.338589],
                  [121.245401,31.339329],
                  [121.251801,31.351371],
                  [121.23649,31.377319],
                  [121.23419,31.386691],
                  [121.239077,31.394335],
                  [121.242239,31.396801],
                  [121.263511,31.330939],
                  [121.266673,31.326251],
                  [121.271847,31.324277],
                  [121.282607,31.325945],
                  [121.292832,31.328965],
                  [121.298006,31.328718],
                  [121.302318,31.326004],
                  [121.322727,31.306013],
                  [121.351473,31.288981],
                  [121.36872,31.285524],
                  [121.396533,31.274628],
                  [121.409827,31.2675],
                  [121.424878,31.24291],
                  [121.442885,31.197593],
                  [121.463007,31.178564],
                  [121.465954,31.165394],
                  [121.512449,31.14791],
                  [121.591213,31.166452],
                  [121.604723,31.142718],
                  [121.613347,31.135795],
                  [121.623121,31.136042],
                  [121.66164,31.14074],
                  [121.66164,31.14074]
                ]
              }, {
                name:'Line12',
                data:[
                  [121.369817,31.137798],
                  [121.401209,31.147426],
                  [121.398329,31.163238],
                  [121.45812,31.179552],
                  [121.460132,31.188202],
                  [121.464156,31.191662],
                  [121.470481,31.193886],
                  [121.463294,31.245521],
                  [121.466832,31.246874],
                  [121.505896,31.25629],
                  [121.529645,31.270325],
                  [121.550557,31.280683],
                  [121.559973,31.285986],
                  [121.572297,31.288882],
                  [121.584889,31.289474],
                  [121.638643,31.285771],
                  [121.645202,31.268948]
                ]
              }, {
                name:'Line13',
                data:[
                  [121.326035,31.247368],
                  [121.351027,31.248742],
                  [121.362136,31.248532],
                  [121.374143,31.24317],
                  [121.395913,31.23717],
                  [121.401707,31.237535],
                  [121.404872,31.237699],
                  [121.421784,31.23717],
                  [121.425377,31.235194],
                  [121.434288,31.238405],
                  [121.458722,31.251989],
                  [121.46749,31.245568],
                  [121.469071,31.239023],
                  [121.469933,31.229389],
                  [121.47056,31.226063],
                  [121.480569,31.22346],
                  [121.474317,31.224386],
                  [121.490917,31.188682]
                ]
              }, {
                name:'Line16',
                data:[
                  [121.93612,30.913673],
                  [121.93612,30.913673],
                  [121.85722,30.965002],
                  [121.804464,30.98924],
                  [121.804464,30.98924],
                  [121.798715,31.058065],
                  [121.768452,31.059659],
                  [121.740073,31.058065],
                  [121.706186,31.056406],
                  [121.655259,31.051489],
                  [121.634001,31.05064],
                  [121.624515,31.058807],
                  [121.617792,31.083402],
                  [121.613533,31.1158],
                  [121.602975,31.147645],
                  [121.586064,31.195083],
                  [121.578522,31.207425],
                  [121.563871,31.208098],
                  [121.453951,31.304443]
                ]
              }
            ];
            const linesColor = {
              'Line1':{ color:'rgb(204,0,0 )' },
              'Line2':{ color:'rgb(0,153,0 )'},
              'Line3':{ color:'rgb(249,225,3 )'},
              'Line4':{ color:'rgb(102,0,102 )'},
              'Line5':{ color:'rgb(204,0,204 ) '},
              'Line6':{ color:'rgb(255,50,101 )'},
              'Line7':{ color:'rgb(255,127,0 )'},
              'Line8':{ color:'rgb(0,102,204 )'},
              'Line9':{ color:'rgb(149, 211, 219)'},
              'Line10':{ color:'rgb(201,167,213 )'},
              'Line11':{ color:'rgb(128,0,0 )'},
              'Line12':{ color:'rgb(12,120,94 )'},
              'Line13':{ color:'rgb(231,150,193 )'},
              'Line16':{ color:'rgb(119,200,199)'},
            };
            //地铁线路层
            this.linesGeojson = [];
            for(let i=0;i<lines.length;i++){
              this.linesGeojson.push({
                'type': 'Feature',
                'geometry': {
                  'type': 'LineString',
                  'coordinates': lines[i].data
                },
                'properties': {
                  'color': linesColor[lines[i].name].color,
                },
              });
            }
            this.mapRoot.addLayer({
              'id': 'line',
              'type': 'line',
              'source': {
                'type': 'geojson',
                'data': {
                  "type": "FeatureCollection",
                  "features": this.linesGeojson
                }
              },
              'layout': {
                'visibility': 'visible',
                'line-cap': 'round',
                'line-join': 'round'
              },
              'paint': {
                'line-color': {
                  'type': 'identity',
                  'property': 'color'
                },
                'line-width': 3,
                'line-opacity': .8
              }
            });
          },
          buildingLayer(){
            //3D建筑层
            var layers = this.mapRoot.getStyle().layers;
            var labelLayerId;
            for (var i = 0; i < layers.length; i++) {
              if (layers[i].type === 'symbol' && layers[i].layout['text-field']) {
                labelLayerId = layers[i].id;
                break;
              }
            }
            this.mapRoot.addLayer({
              'id': '3d-buildings',
              'source': 'composite',
              'source-layer': 'building',
              'filter': ['==', 'extrude', 'true'],
              'type': 'fill-extrusion',
              'minzoom': 15,
              'paint': {
                'fill-extrusion-color': '#aaa',
                'fill-extrusion-height': [
                  "interpolate", ["linear"], ["zoom"],
                  15, 0,
                  15.05, ["get", "height"]
                ],
                'fill-extrusion-base': [
                  "interpolate", ["linear"], ["zoom"],
                  15, 0,
                  15.05, ["get", "min_height"]
                ],
                'fill-extrusion-opacity': .6
              }
            }, labelLayerId);
          },
          heatMap(){
            /*this.mapRoot.addSource('earthquakes', {
              "type": "geojson",
              "data": "./static/earthquakes.geojson"
            });*/
            this.mapRoot.addLayer({
              "id": "earthquakes-heat",
              "type": "heatmap",
              "source": {
                  "type":"geojson",
                  "data":{
                    "type": "FeatureCollection",
                    "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
                    "features": [
                      {
                        "type": "Feature",
                        "properties": { "id": "ak16994521", "mag": 2.3, "time": 1507425650893, "felt": null, "tsunami": 0 },
                        "geometry": {
                          "type": "Point",
                          "coordinates": [ 121.498,31.229 ]
                        }
                      },
                      {
                          "type": "Feature",
                        "properties": { "id": "ak16994519", "mag": 1.7, "time": 1507425289659, "felt": null, "tsunami": 0 },
                        "geometry": {
                          "type": "Point",
                          "coordinates": [ 121.499,31.230 ]
                          }
                      },
                    ]
                  }
              },
              "maxzoom": 9,
              "paint": {
                "heatmap-weight": {
                  "property": "mag",
                  "type": "exponential",
                  "stops": [
                    [0, 0],
                    [6, 1]
                  ]
                },
                "heatmap-intensity": {
                  "stops": [
                    [0, 1],
                    [9, 3]
                  ]
                },
                "heatmap-color": [
                  "interpolate",
                  ["linear"],
                  ["heatmap-density"],
                  0, "rgba(33,102,172,0)",
                  0.2, "rgb(103,169,207)",
                  0.4, "rgb(209,229,240)",
                  0.6, "rgb(253,219,199)",
                  0.8, "rgb(239,138,98)",
                  1, "rgb(178,24,43)"
                ],
                "heatmap-radius": {
                  "stops": [
                    [0, 2],
                    [9, 20]
                  ]
                },
                "heatmap-opacity": {
                  "default": 1,
                  "stops": [
                    [7, 1],
                    [9, 0]
                  ]
                },
              }
            }, 'waterway-label');
            this.mapRoot.addLayer({
              "id": "earthquakes-point",
              "type": "circle",
              "source": {
                "type":"geojson",
                "data":{
                  "type": "FeatureCollection",
                  "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
                  "features": [
                    {
                      "type": "Feature",
                      "properties": { "id": "ak16994521", "mag": 2.3, "time": 1507425650893, "felt": null, "tsunami": 0 },
                      "geometry": {
                        "type": "Point",
                        "coordinates": [ 121.498,31.229 ]
                      }
                    },
                    {
                      "type": "Feature",
                      "properties": { "id": "ak16994519", "mag": 1.7, "time": 1507425289659, "felt": null, "tsunami": 0 },
                      "geometry": {
                        "type": "Point",
                        "coordinates": [ 121.499,31.230 ]
                      }
                    },
                  ]
                }
              },
              "minzoom": 7,
              "paint": {
                "circle-radius": {
                  "property": "mag",
                  "type": "exponential",
                  "stops": [
                    [{ zoom: 7, value: 1 }, 1],
                    [{ zoom: 7, value: 6 }, 4],
                    [{ zoom: 16, value: 1 }, 5],
                    [{ zoom: 16, value: 6 }, 50],
                  ]
                },
                "circle-color": {
                  "property": "mag",
                  "type": "exponential",
                  "stops": [
                    [1, "rgba(33,102,172,0)"],
                    [2, "rgb(103,169,207)"],
                    [3, "rgb(209,229,240)"],
                    [4, "rgb(253,219,199)"],
                    [5, "rgb(239,138,98)"],
                    [6, "rgb(178,24,43)"]
                  ]
                },
                "circle-stroke-color": "white",
                "circle-stroke-width": 1,
                "circle-opacity": {
                  "stops": [
                    [7, 0],
                    [8, 1]
                  ]
                }
              }
            }, 'waterway-label');
          },
          test(){

          },
        },
        mounted: function () {
          this.mapInit();
        }
    }
</script>
